







<!DOCTYPE html>
<html  lang="en">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    
    <title>Recipes | miros-xml</title>
    <link rel="shortcut icon" href="_static/favicon.ico">

    
    <link rel="stylesheet" href="_static/pygments.css" type="text/css">
    <link rel="stylesheet" href="_static/theme.css" type="text/css">
    
    

    
    <script type="text/javascript" src="_static/theme.js" defer></script>
    <script id="documentation_options" data-url_root="./" src="_static/documentation_options.js"></script>
    
    <script src="_static/jquery.js"></script>
    
    <script src="_static/underscore.js"></script>
    
    <script src="_static/doctools.js"></script>
    
    

    
      
      
    <link rel="index" title="Index" href="genindex.html">
      
      
    <link rel="search" title="Search" href="search.html">
      
      
      
    <link rel="next" title="How it Works" href="how_it_works.html">
      
      
    <link rel="prev" title="Getting Your Head in the Project" href="quickstart.html">
      
    

    

    

    
  </head>

  <body>
    <header class="main-header">
      <div class="navbar">
        <div id="js-sidebar-mask" class="sidebar-mask"></div>
        <div id="js-sidebar-menu-button" class="sidebar-menu-button">
          <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg>
        </div>
        <a href="index.html" class="site-link">
          
          miros-xml
          
        </a>
        <div class="navbar-links">
          <a href="installation.html" class="navbar-link">Docs</a>
          
          <a href="https://github.com/aleph2c/miros-xml" class="navbar-link">GitHub</a><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="external-link-icon"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg>
          
        </div>
      </div>
    </header>

    <main class="main-wrapper">
      
      <div id="js-main-sidebar" class="main-sidebar">
        
        <div class="sidebar-content sidebar-content--divider sidebar-navbar-links">
          <a href="https://github.com/aleph2c/miros-xml" class="sidebar-navbar-link">GitHub</a>
          <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="external-link-icon"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg>
        </div>
        
        
        <h3 class="sidebar-heading">About</h3>
<ul>
  <li>XML for <a "https://github.com/aleph2c/miros">miros</a> 
</ul>
        
        

<h2 class="sidebar-heading">Contents</h2>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="installation.html">Installation</a></li>
<li class="toctree-l1"><a class="reference internal" href="introduction.html">Introduction</a></li>
<li class="toctree-l1"><a class="reference internal" href="quickstart.html">Getting Your Head in the Project</a></li>
<li class="toctree-l1 current"><a class="current reference internal" href="#">Recipes</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#finding-a-function-method-s-decorators">Finding a Function/Method’s Decorators</a></li>
<li class="toctree-l2"><a class="reference internal" href="#creating-functions-from-templates">Creating Functions from Templates</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="how_it_works.html">How it Works</a></li>
</ul>

        
        <h3 class="sidebar-heading">Useful Links</h3>
  <ul>
    <li><a href="https://aleph2c.github.io/miros-rabbitmq/html/index.html">miros on github</a></li>
    <li><a href="https://github.com/aleph2c/sequence">sequence on
        github</a></li>
    <li><a
          href="https://aleph2c.github.io/miros-rabbitmq/html/index.html">miros-rabbitmq
          plugin</a></li>
    <li><a href="http://www.umlet.com">UMLet Download</a></li>
    <li><a
          href="http://www.inf.ed.ac.uk/teaching/courses/seoc/2005_2006/resources/statecharts.pdf">formalism
          explained</a></li>
  </ul>
<h3 class="sidebar-heading">Statechart Videos</h3>
  <ul>
    <li><a href="https://www.mathworks.com/videos/understanding-state-machines-what-are-they-1-of-4-90488.html">Part 1 (What)</a></li> 
    <li><a
          href="https://www.mathworks.com/videos/understanding-state-machines-why-use-them-2-of-4-90489.html">Part 2 (Why)</a></li>
    <li><a
          href="https://www.mathworks.com/videos/understanding-state-machines-what-are-they-1-of-4-90488.html">Part 3 (Mealy/Moore)</a></li>
    <li><a
          href="https://www.mathworks.com/videos/understanding-state-machines-harel-state-machines-4-of-4-90491.html">Part 4 (Harel Statecharts)</a></li>
    <li><a href="https://barrgroup.com/Embedded-Systems/How-To/Introduction-Hierarchical-State-Machines">Introduction to HSMs</a></li>
</ul>
        
        

<div id="searchbox" style="display: none" role="search">
  <h2 id="searchlabel" class="sidebar-heading">Quick search</h2>
  <div class="searchformwrapper sidebar-content">
    <form class="search" action="search.html" method="get">
      <input class="sidebar-search sidebar-search--input" type="text" name="q" aria-labelledby="searchlabel"><input class="sidebar-search sidebar-search--btn" type="submit" value="Go">
    </form>
  </div>
</div>
<script>$('#searchbox').show(0);</script>

        
      </div>
      

      
      <div class="main-content main-content--sidebar">
      
        
          
  <div class="section" id="recipes">
<h1>Recipes<a class="headerlink" href="#recipes" title="Permalink to this headline">#</a></h1>
<div class="contents local topic" id="contents">
<ul class="simple">
<li><p><a class="reference internal" href="#finding-a-function-method-s-decorators" id="id1">Finding a Function/Method’s Decorators</a></p></li>
<li><p><a class="reference internal" href="#creating-functions-from-templates" id="id2">Creating Functions from Templates</a></p></li>
</ul>
</div>
<p>This section will focus on Python techniques that aren’t specific to the design.</p>
<div class="section" id="finding-a-function-method-s-decorators">
<span id="recipes-finding-the-decorators-for-a-function-method"></span><h2>Finding a Function/Method’s Decorators<a class="headerlink" href="#finding-a-function-method-s-decorators" title="Permalink to this headline">#</a></h2>
<p>This package is automatically building functions, which will be based on hand
written functions which have been instrumented by function wrappers
(decorators).  To reflect upon how a function has been decorated, so you can
programmatically build your own version of it, you can use the solution provided
by Shane Holloway on <a class="reference external" href="https://stackoverflow.com/a/9580006">stackoverflow</a>.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">find_decorators</span><span class="p">(</span><span class="n">target</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;find a method/function&#39;s decorators</span>

<span class="sd">    **Note**:</span>
<span class="sd">       This function will not work for function&#39;s built from templates</span>

<span class="sd">       Solution provided by Shane Holloway on `stackoverflow</span>
<span class="sd">       &lt;https://stackoverflow.com/a/9580006&gt;`_</span>

<span class="sd">    **Args**:</span>
<span class="sd">       | ``target`` (callable): the function/method</span>


<span class="sd">    **Returns**:</span>
<span class="sd">       (dict): key/value pair, key is the function/method the value is array</span>
<span class="sd">      |        of decorators</span>

<span class="sd">    **Example(s)**:</span>

<span class="sd">    .. code-block:: python</span>

<span class="sd">        find_decorators(p_p22_s22)  \</span>
<span class="sd">             # =&gt; {&#39;p_p22_s22&#39;: [&quot;Name(id=&#39;orthogonal_state&#39;, ctx=Load())&quot;]</span>

<span class="sd">        find_decorators(p)  # =&gt; {&#39;p&#39;: [&quot;Name(id=&#39;state&#39;, ctx=Load())&quot;]</span>

<span class="sd">    &#39;&#39;&#39;</span>
    <span class="kn">import</span> <span class="nn">ast</span><span class="o">,</span> <span class="nn">inspect</span>
    <span class="n">res</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="k">def</span> <span class="nf">visit_FunctionDef</span><span class="p">(</span><span class="n">node</span><span class="p">):</span>
        <span class="n">res</span><span class="p">[</span><span class="n">node</span><span class="o">.</span><span class="n">name</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="n">ast</span><span class="o">.</span><span class="n">dump</span><span class="p">(</span><span class="n">e</span><span class="p">)</span> <span class="k">for</span> <span class="n">e</span> <span class="ow">in</span> <span class="n">node</span><span class="o">.</span><span class="n">decorator_list</span><span class="p">]</span>

    <span class="n">V</span> <span class="o">=</span> <span class="n">ast</span><span class="o">.</span><span class="n">NodeVisitor</span><span class="p">()</span>
    <span class="n">V</span><span class="o">.</span><span class="n">visit_FunctionDef</span> <span class="o">=</span> <span class="n">visit_FunctionDef</span>
    <span class="n">V</span><span class="o">.</span><span class="n">visit</span><span class="p">(</span><span class="nb">compile</span><span class="p">(</span><span class="n">inspect</span><span class="o">.</span><span class="n">getsource</span><span class="p">(</span><span class="n">target</span><span class="p">),</span> <span class="s2">&quot;?&quot;</span><span class="p">,</span> <span class="s1">&#39;exec&#39;</span><span class="p">,</span> <span class="n">ast</span><span class="o">.</span><span class="n">PyCF_ONLY_AST</span><span class="p">))</span>
    <span class="k">return</span> <span class="n">res</span>
</pre></div>
</div>
</div>
<div class="section" id="creating-functions-from-templates">
<span id="recipes-creating-functions-from-templates"></span><h2>Creating Functions from Templates<a class="headerlink" href="#creating-functions-from-templates" title="Permalink to this headline">#</a></h2>
<p>The miros-xml package <span class="xref std std-ref">adds four hidden functions</span> (grey in the diagram) for
each orthogonal state:</p>
<a class="reference external image-reference" href="_static/hidden_states_1.pdf"><img alt="_images/hidden_states_1.svg" class="noscale-center" src="_images/hidden_states_1.svg" /></a>
<p><strong>Goal</strong>: We want the <code class="docutils literal notranslate"><span class="pre">add</span></code> method of the <code class="docutils literal notranslate"><span class="pre">Regions</span></code> object to create the grayed
out functions for us, using a predetermined naming convention.</p>
<p>We will use the module_namespace to attach and get functions based on a string,
using the Python <code class="docutils literal notranslate"><span class="pre">setattr/getattr</span></code> builtins.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">sys</span>
<span class="n">module_namespace</span> <span class="o">=</span> <span class="n">sys</span><span class="o">.</span><span class="n">modules</span><span class="p">[</span><span class="vm">__name__</span><span class="p">]</span>

<span class="c1"># these are the same</span>
<span class="n">module_namespace</span><span class="o">.</span><span class="n">p_r1_under_hidden_region</span><span class="p">()</span>
<span class="nb">getattr</span><span class="p">(</span><span class="n">module_namespace</span><span class="p">,</span> <span class="s1">&#39;p_r1_under_hidden_region&#39;</span><span class="p">)()</span>
</pre></div>
</div>
<p>Before we make something that writes functions, we will type one out by hand,
have a full regression test pass, then identify the parts of the function we
want to change:</p>
<div class="highlight-python notranslate"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="nd">@othogonal_state</span>
<span class="hll"><span class="k">def</span> <span class="nf">p_r1_under_hidden_region</span><span class="p">(</span><span class="n">r</span><span class="p">,</span> <span class="n">e</span><span class="p">):</span>
</span>  <span class="n">status</span> <span class="o">=</span> <span class="n">return_status</span><span class="o">.</span><span class="n">UNHANDLED</span>
  <span class="n">__super__</span> <span class="o">=</span> <span class="n">r</span><span class="o">.</span><span class="n">bottom</span>

  <span class="k">if</span><span class="p">(</span><span class="n">e</span><span class="o">.</span><span class="n">signal</span> <span class="o">==</span> <span class="n">SEARCH_FOR_SUPER_SIGNAL</span><span class="p">):</span>
    <span class="n">r</span><span class="o">.</span><span class="n">temp</span><span class="o">.</span><span class="n">fun</span> <span class="o">=</span> <span class="n">__super__</span>
    <span class="k">return</span> <span class="n">return_status</span><span class="o">.</span><span class="n">SUPER</span>

  <span class="k">if</span><span class="p">(</span><span class="n">r</span><span class="o">.</span><span class="n">token_match</span><span class="p">(</span><span class="n">e</span><span class="o">.</span><span class="n">signal_name</span><span class="p">,</span> <span class="s2">&quot;enter_region&quot;</span><span class="p">)):</span>
    <span class="n">r</span><span class="o">.</span><span class="n">_p_spy</span><span class="p">(</span><span class="n">e</span><span class="p">)</span>
<span class="hll">    <span class="n">status</span> <span class="o">=</span> <span class="n">r</span><span class="o">.</span><span class="n">trans</span><span class="p">(</span><span class="n">p_r1_region</span><span class="p">)</span>
</span>  <span class="k">elif</span><span class="p">(</span><span class="n">e</span><span class="o">.</span><span class="n">signal</span> <span class="o">==</span> <span class="n">signals</span><span class="o">.</span><span class="n">INIT_SIGNAL</span><span class="p">):</span>
    <span class="n">r</span><span class="o">.</span><span class="n">_p_spy</span><span class="p">(</span><span class="n">e</span><span class="p">)</span>
    <span class="n">status</span> <span class="o">=</span> <span class="n">return_status</span><span class="o">.</span><span class="n">HANDLED</span>
  <span class="k">elif</span><span class="p">(</span><span class="n">e</span><span class="o">.</span><span class="n">signal</span> <span class="o">==</span> <span class="n">signals</span><span class="o">.</span><span class="n">ENTRY_SIGNAL</span><span class="p">):</span>
    <span class="n">r</span><span class="o">.</span><span class="n">_p_spy</span><span class="p">(</span><span class="n">e</span><span class="p">)</span>
    <span class="n">status</span> <span class="o">=</span> <span class="n">return_status</span><span class="o">.</span><span class="n">HANDLED</span>
  <span class="k">else</span><span class="p">:</span>
    <span class="n">r</span><span class="o">.</span><span class="n">temp</span><span class="o">.</span><span class="n">fun</span> <span class="o">=</span> <span class="n">__super__</span>
    <span class="n">status</span> <span class="o">=</span> <span class="n">return_status</span><span class="o">.</span><span class="n">SUPER</span>
  <span class="k">return</span> <span class="n">status</span>
</pre></div>
</td></tr></table></div>
<p>Things that need to change in the above function:</p>
<ul class="simple">
<li><p>it needs a unique name (line 1)</p></li>
<li><p>it will reference the <code class="docutils literal notranslate"><span class="pre">p_r1_region</span></code> function, line 12.</p></li>
</ul>
<p>Now we write a template, knowing that we will rename it later.  We use the
<code class="docutils literal notranslate"><span class="pre">*</span></code>, character to separate the non-mandatorily-named arguments from the ones
that require a name; <code class="docutils literal notranslate"><span class="pre">region_state_name</span></code>.</p>
<div class="highlight-python notranslate"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">template_under_hidden_region</span><span class="p">(</span><span class="n">r</span><span class="p">,</span> <span class="n">e</span><span class="p">,</span> <span class="o">*</span><span class="p">,</span> <span class="n">region_state_name</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
  <span class="sd">&#39;&#39;&#39;some docstring&#39;&#39;&#39;</span>

  <span class="n">status</span> <span class="o">=</span> <span class="n">return_status</span><span class="o">.</span><span class="n">UNHANDLED</span>
  <span class="n">__super__</span> <span class="o">=</span> <span class="n">r</span><span class="o">.</span><span class="n">bottom</span>

<span class="hll">  <span class="n">region_state_function</span> <span class="o">=</span> \
</span><span class="hll">    <span class="nb">getattr</span><span class="p">(</span><span class="n">module_namespace</span><span class="p">,</span> <span class="n">region_state_name</span><span class="p">)</span>
</span>
  <span class="k">if</span><span class="p">(</span><span class="n">e</span><span class="o">.</span><span class="n">signal</span> <span class="o">==</span> <span class="n">SEARCH_FOR_SUPER_SIGNAL</span><span class="p">):</span>
    <span class="n">r</span><span class="o">.</span><span class="n">temp</span><span class="o">.</span><span class="n">fun</span> <span class="o">=</span> <span class="n">__super__</span>
    <span class="k">return</span> <span class="n">return_status</span><span class="o">.</span><span class="n">SUPER</span>

  <span class="k">if</span><span class="p">(</span><span class="n">r</span><span class="o">.</span><span class="n">token_match</span><span class="p">(</span><span class="n">e</span><span class="o">.</span><span class="n">signal_name</span><span class="p">,</span> <span class="s2">&quot;enter_region&quot;</span><span class="p">)):</span>
    <span class="n">r</span><span class="o">.</span><span class="n">_p_spy</span><span class="p">(</span><span class="n">e</span><span class="p">)</span>
<span class="hll">    <span class="n">status</span> <span class="o">=</span> <span class="n">r</span><span class="o">.</span><span class="n">trans</span><span class="p">(</span><span class="n">region_state_function</span><span class="p">)</span>
</span>  <span class="k">elif</span><span class="p">(</span><span class="n">e</span><span class="o">.</span><span class="n">signal</span> <span class="o">==</span> <span class="n">signals</span><span class="o">.</span><span class="n">ENTRY_SIGNAL</span><span class="p">):</span>
    <span class="n">r</span><span class="o">.</span><span class="n">_p_spy</span><span class="p">(</span><span class="n">e</span><span class="p">)</span>
    <span class="n">status</span> <span class="o">=</span> <span class="n">return_status</span><span class="o">.</span><span class="n">HANDLED</span>
  <span class="k">elif</span><span class="p">(</span><span class="n">e</span><span class="o">.</span><span class="n">signal</span> <span class="o">==</span> <span class="n">signals</span><span class="o">.</span><span class="n">INIT_SIGNAL</span><span class="p">):</span>
    <span class="n">r</span><span class="o">.</span><span class="n">_p_spy</span><span class="p">(</span><span class="n">e</span><span class="p">)</span>
    <span class="n">status</span> <span class="o">=</span> <span class="n">return_status</span><span class="o">.</span><span class="n">HANDLED</span>
  <span class="k">elif</span><span class="p">(</span><span class="n">e</span><span class="o">.</span><span class="n">signal</span> <span class="o">==</span> <span class="n">signals</span><span class="o">.</span><span class="n">EXIT_SIGNAL</span><span class="p">):</span>
    <span class="n">r</span><span class="o">.</span><span class="n">_p_spy</span><span class="p">(</span><span class="n">e</span><span class="p">)</span>
    <span class="n">status</span> <span class="o">=</span> <span class="n">return_status</span><span class="o">.</span><span class="n">HANDLED</span>
  <span class="k">else</span><span class="p">:</span>
    <span class="n">r</span><span class="o">.</span><span class="n">temp</span><span class="o">.</span><span class="n">fun</span> <span class="o">=</span> <span class="n">__super__</span>
    <span class="n">status</span> <span class="o">=</span> <span class="n">return_status</span><span class="o">.</span><span class="n">SUPER</span>
  <span class="k">return</span> <span class="n">status</span>
</pre></div>
</td></tr></table></div>
<p>Notice on lines 7-8, we use <code class="docutils literal notranslate"><span class="pre">getattr(module_namespace,</span> <span class="pre">region_state_name)</span></code> to
call the function.  This function is used on line 16.</p>
<p>If <code class="docutils literal notranslate"><span class="pre">region_state_name</span></code> was set to <code class="docutils literal notranslate"><span class="pre">p_r1_region</span></code>, our function would behave
the same as the one we wrote out by hand.  Notice, that the template does not
have an <code class="docutils literal notranslate"><span class="pre">orthogonal</span></code> wrapper, this will be added later.</p>
<p>Now we want to create a new function based on some naming conventions:</p>
<div class="highlight-python notranslate"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
55
56
57
58
59
60
61
62
63
64
65
66
67
68
69
70
71
72</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">functools</span> <span class="kn">import</span> <span class="n">partial</span>
<span class="kn">from</span> <span class="nn">functools</span> <span class="kn">import</span> <span class="n">lru_cache</span>
<span class="kn">from</span> <span class="nn">functools</span> <span class="kn">import</span> <span class="n">update_wrapper</span>

<span class="c1"># functions at the top of the file</span>
<span class="nd">@lru_cache</span><span class="p">(</span><span class="n">maxsize</span><span class="o">=</span><span class="mi">128</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">under_hidden_region_function_name</span><span class="p">(</span><span class="n">region_name</span><span class="p">):</span>
  <span class="k">return</span> <span class="n">region_name</span> <span class="o">+</span> <span class="s2">&quot;_under_hidden_region&quot;</span>

<span class="nd">@lru_cache</span><span class="p">(</span><span class="n">maxsize</span><span class="o">=</span><span class="mi">128</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">region_function_name</span><span class="p">(</span><span class="n">region_name</span><span class="p">):</span>
  <span class="k">return</span> <span class="n">region_name</span> <span class="o">+</span> <span class="s2">&quot;_region&quot;</span>

<span class="nd">@lru_cache</span><span class="p">(</span><span class="n">maxsize</span><span class="o">=</span><span class="mi">128</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">over_hidden_region_function_name</span><span class="p">(</span><span class="n">region_name</span><span class="p">):</span>
  <span class="k">return</span> <span class="n">region_name</span> <span class="o">+</span> <span class="s2">&quot;_over_hidden_region&quot;</span>

<span class="nd">@lru_cache</span><span class="p">(</span><span class="n">maxsize</span><span class="o">=</span><span class="mi">128</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">final_region_function_name</span><span class="p">(</span><span class="n">region_name</span><span class="p">):</span>
  <span class="k">return</span> <span class="n">region_name</span> <span class="o">+</span> <span class="s2">&quot;_final&quot;</span>

<span class="c1"># ..</span>

<span class="c1"># in the Regions class:</span>
<span class="k">def</span> <span class="nf">add</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">region_name</span><span class="p">,</span> <span class="n">outer</span><span class="p">):</span>
  <span class="c1"># ...</span>
  <span class="n">region_name</span> <span class="o">=</span> <span class="s2">&quot;p_r1&quot;</span>  <span class="c1"># force the region_name for our example</span>
  <span class="n">under_s</span> <span class="o">=</span> <span class="n">under_hidden_region_function_name</span><span class="p">(</span><span class="n">region_name</span><span class="p">)</span>
  <span class="n">region_s</span> <span class="o">=</span> <span class="n">region_function_name</span><span class="p">(</span><span class="n">region_name</span><span class="p">)</span>
  <span class="n">over_s</span> <span class="o">=</span> <span class="n">over_hidden_region_function_name</span><span class="p">(</span><span class="n">region_name</span><span class="p">)</span>
  <span class="n">final_s</span> <span class="o">=</span> <span class="n">final_region_function_name</span><span class="p">(</span><span class="n">region_name</span><span class="p">)</span>

  <span class="c1"># only the template_under_hidden_region and under_state_function=under_s</span>
  <span class="c1"># variables used by the template, the rest caught by kwargs.  We do this so</span>
  <span class="c1"># all templates are made the same way, the user doesn&#39;t have to care what is</span>
  <span class="c1"># needed or what isn&#39;t, you just include all of the information and the</span>
  <span class="c1"># template uses what it needs.</span>
<span class="hll">  <span class="n">under_hidden_state_function</span> <span class="o">=</span> <span class="n">partial</span><span class="p">(</span>
</span><span class="hll">    <span class="n">template_under_hidden_region</span><span class="p">,</span>
</span><span class="hll">    <span class="n">under_state_function</span><span class="o">=</span><span class="n">under_s</span><span class="p">,</span>
</span><span class="hll">    <span class="n">region_state_name</span><span class="o">=</span><span class="n">region_s</span><span class="p">,</span>
</span><span class="hll">    <span class="n">over_state_function</span><span class="o">=</span><span class="n">over_s</span><span class="p">,</span>
</span><span class="hll">    <span class="n">final_state_function</span><span class="o">=</span><span class="n">final_s</span>
</span><span class="hll">  <span class="p">)</span>
</span>  <span class="c1"># add the __doc__ and __name__ from the template_under_hidden_region</span>
  <span class="c1"># to the under_hidden_state_function</span>
<span class="hll">  <span class="n">under_hidden_state_function</span> <span class="o">=</span> <span class="n">update_wrapper</span><span class="p">(</span><span class="n">under_hidden_state_function</span><span class="p">,</span>
</span><span class="hll">      <span class="n">template_under_hidden_region</span><span class="p">)</span>
</span>
  <span class="c1"># change the name of the under_hidden_state_function to</span>
  <span class="c1"># &#39;p_r1_under_hidden_region&#39;</span>
<span class="hll">  <span class="n">under_hidden_state_function</span><span class="o">.</span><span class="vm">__name__</span> <span class="o">=</span> <span class="n">under_s</span>
</span>
  <span class="c1"># add our orthogonal_state instrumentation decorator.  This decorator uses</span>
  <span class="c1"># the &#39;@wraps(fn)&#39; decorator, so that the name is conserved after it has</span>
  <span class="c1"># been wrapped.  So under_hidden_state_function is still called</span>
  <span class="c1"># &#39;p_r1_under_hidden_region&#39; after it has been decorated</span>
<span class="hll">  <span class="n">under_hidden_state_function</span> <span class="o">=</span> <span class="n">othogonal_state</span><span class="p">(</span><span class="n">under_hidden_state_function</span><span class="p">)</span>
</span>
  <span class="c1"># add the newly created &#39;p_r1_under_hidden_region&#39; function to our module&#39;s</span>
  <span class="c1"># namespace</span>
<span class="hll">  <span class="nb">setattr</span><span class="p">(</span>
</span><span class="hll">    <span class="n">module_namespace</span><span class="p">,</span>
</span><span class="hll">    <span class="n">under_s</span><span class="p">,</span>
</span><span class="hll">    <span class="n">under_hidden_state_function</span><span class="p">,</span>
</span><span class="hll">  <span class="p">)</span>
</span>  <span class="k">assert</span><span class="p">(</span><span class="n">under_hidden_state_function</span><span class="o">.</span><span class="vm">__name__</span> <span class="o">==</span> <span class="n">under_s</span><span class="p">)</span>
  <span class="k">assert</span> <span class="n">callable</span><span class="p">(</span><span class="n">under_hidden_state_function</span><span class="p">)</span>
  <span class="k">assert</span> <span class="n">callable</span><span class="p">(</span><span class="nb">getattr</span><span class="p">(</span><span class="n">module_namespace</span><span class="p">,</span> <span class="n">under_s</span><span class="p">))</span>

  <span class="c1"># ... build other hidden functions</span>
  <span class="c1"># ... construct the regions</span>
</pre></div>
</td></tr></table></div>
<p>The function is created on lines 38-44.  We use the <code class="docutils literal notranslate"><span class="pre">partial</span></code> function to set
some default parameters for this function, then assign it to the
<code class="docutils literal notranslate"><span class="pre">under_hidden_state_function</span></code> variable.  Then we give it the meta data from
the <code class="docutils literal notranslate"><span class="pre">template_under_hidden_region</span></code> on lines 47 and 48.  Then we explicitely
name it on line 52.</p>
<p>Once our function is named, we wrap its orthogonal_state decorator, line 58.  On lines 62
to 66 we add this named function to the module’s namespace.  At this point we
can call <code class="docutils literal notranslate"><span class="pre">p_r1_under_hidden_region</span></code> as it we wrote it by hand.</p>
<p>The <code class="docutils literal notranslate"><span class="pre">p_r1_under_hidden_region</span></code> function has been programmatically created, so
we delete the one we made by hand, the rerun our regression to ensure the system
still works.</p>
<p>To complete the work we follow the same process for the <code class="docutils literal notranslate"><span class="pre">final</span></code>, <code class="docutils literal notranslate"><span class="pre">region</span></code> and <code class="docutils literal notranslate"><span class="pre">over_hidden_region</span></code> functions.</p>
<div class="admonition warning">
<p class="admonition-title">Warning</p>
<p>If you have done work like this, never use the eval(function_name_as_string)
to get access to the function.  This will destroy the function’s <code class="docutils literal notranslate"><span class="pre">__name__</span></code> and
<code class="docutils literal notranslate"><span class="pre">__doc__</span></code> values and cause your tests to fail.</p>
</div>
</div>
</div>


        
        <div class="main-content__right-sidebar">
          <h2 class="sidebar-heading">On this page:</h2>
        </div>
      </div>
    </main>

    <div class="footer-wrapper">
      
      <footer class="main-footer main-footer--sidebar">
      
        <div class="relational-links">
          <div>
            
            ← <a class="relational-link" href="quickstart.html" title="previous chapter">Getting Your Head in the Project</a>
            
          </div>
          <div>
            
             <a class="relational-link" href="how_it_works.html" title="next chapter">How it Works</a> →
            
          </div>
        </div>
        
        <div class="copyright">
          © Copyright <span class="js-year"></span>,
          
          <a href="https://github.com/aleph2c" class="copyright_link">Scott Volk</a>.
          
        </div>
        
        
        <div class="last-updated">
          <span class="prefix">Last updated:</span>
          <span class="time">Jan 05, 2021 6:55 PM</span>
        </div>
        
        
        <div class="created-with">
          Created using <a href="http://sphinx-doc.org/" class="copyright_link">Sphinx</a> 3.4.0 with <span class="theme">13ds_theme_one</span>.
        </div>
        
      </footer>
    </div>
  </body>
</html>